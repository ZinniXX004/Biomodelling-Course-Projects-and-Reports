unit Unit2;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, VclTee.TeeGDIPlus, Vcl.StdCtrls,
  VCLTee.TeEngine, VCLTee.Series, Vcl.ExtCtrls, VCLTee.TeeProcs, VCLTee.Chart, math,
  Vcl.Buttons;

type
  TForm2 = class(TForm)
    SaveDialog1: TSaveDialog;
    OpenDialog1: TOpenDialog;
    OpenDialog2: TOpenDialog;
    ScrollBox1: TScrollBox;
    Button1: TButton;
    Button2: TButton;
    Button3: TButton;
    Button4: TButton;
    Button5: TButton;
    Chart1: TChart;
    Series1: TLineSeries;
    Chart2: TChart;
    Series2: TLineSeries;
    Series3: TLineSeries;
    Edit1: TEdit;
    Label1: TLabel;
    ListBox1: TListBox;
    ListBox2: TListBox;
    BitBtn1: TBitBtn;
    GroupBox1: TGroupBox;
    procedure Button1Click(Sender: TObject);
    procedure Button2Click(Sender: TObject);
    procedure Button4Click(Sender: TObject);
    procedure Button3Click(Sender: TObject);
    procedure Button5Click(Sender: TObject);
    procedure BitBtn1Click(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  Form2: TForm2;

implementation

{$R *.dfm}

procedure TForm2.BitBtn1Click(Sender: TObject);
begin
  Close;
end;

procedure TForm2.Button1Click(Sender: TObject);
var
  n: Integer;
  ltheta, fl, lopt: Double;
  fls: string;
begin
  lopt := StrToFloat(Edit1.Text);
  Series1.Clear;
  ListBox1.Clear;

  for n := 0 to 100 do
  begin
    ltheta := (0.5 * lopt) + n * ((1.5 * lopt) - (0.5 * lopt)) / 100;
    fl := 1 - Power((ltheta - lopt) / (0.5 * lopt), 2);
    Str(fl:3:4, fls);
    ListBox1.Items.Add(FloatToStrF(ltheta, ffFixed, 8, 4) + ' | ' + fls);
    Series1.AddXY(ltheta, fl);
  end;
end;

procedure TForm2.Button2Click(Sender: TObject);
var
  vmax, i: Integer;
  c, v, f_v: Double;
begin
  vmax := 3;
  c := 2.5;
  ListBox2.Clear;

  // Perhitungan untuk v dari -1 hingga 0
  for i := 0 to 100 do
  begin
    v := -1 + i / 100.0;
    f_v := (vmax - v) / (vmax + c * v);
    v := (-v - 1);
    f_v := f_v / 8;

    Series2.AddXY(v, f_v);

    ListBox2.Items.Add(Format('%.3f |%.3f', [v, f_v]));
  end;

  // Perhitungan untuk v dari 0 hingga 0.5
  for i := 0 to 50 do
  begin
    v := i / 100.0;
    f_v := 1.3 - (0.3 * ((vmax - c * vmax) / (1 + c * c * v)));
    f_v := (-f_v / 3) + 1.8833;

    Series3.AddXY(v, f_v);

    ListBox2.Items.Add(Format('%.3f |%.3f', [v, f_v]));
  end;
end;

procedure TForm2.Button3Click(Sender: TObject);
begin
  Close;
end;

procedure TForm2.Button4Click(Sender: TObject);
var
  SaveDialog1: TSaveDialog;
  ListBoxContent: TStringList;
begin
  SaveDialog1 := TSaveDialog.Create(Self);
  ListBoxContent := TStringList.Create;
  try
    SaveDialog1.Filter := 'Text Files (*.txt)|*.txt|All Files (*.*)|*.*';
    SaveDialog1.DefaultExt := 'txt';

    // Menyimpan ListBox1
    SaveDialog1.Title := 'Data ListBox1';
    if SaveDialog1.Execute then
    begin
      ListBoxContent.Assign(ListBox1.Items); // Salin isi ListBox1
      ListBoxContent.SaveToFile(SaveDialog1.FileName);
    end;

    // Menyimpan ListBox2
    SaveDialog1.Title := 'Data ListBox2';
    if SaveDialog1.Execute then
    begin
      ListBoxContent.Assign(ListBox2.Items); // Salin isi ListBox2
      ListBoxContent.SaveToFile(SaveDialog1.FileName);
    end;
  finally
    SaveDialog1.Free;
    ListBoxContent.Free;
  end;
end;

procedure TForm2.Button5Click(Sender: TObject);
var
  FileLines1, FileLines2: TStringList;
  LineData: TStringList;
  FileName1, FileName2: string;
  i: Integer;
  XValue, YValue: Double;
begin
  FileLines1 := TStringList.Create;
  FileLines2 := TStringList.Create;
  LineData := TStringList.Create;

  try
    // Pilih file pertama
    if OpenDialog1.Execute then
    begin
      FileName1 := OpenDialog1.FileName;
      if FileExists(FileName1) then
      begin
        FileLines1.LoadFromFile(FileName1);

        // Kosongkan ListBox1 dan Series1
        ListBox1.Clear;
        Chart1.Series[0].Clear;

        // Proses file pertama
        for i := 0 to FileLines1.Count - 1 do
        begin
          LineData.CommaText := StringReplace(FileLines1[i], '|', ',', [rfReplaceAll]);

          if LineData.Count = 2 then
          begin
            XValue := StrToFloatDef(LineData[0], 0);
            YValue := StrToFloatDef(LineData[1], 0);

            ListBox1.Items.Add(FileLines1[i]);
            Chart1.Series[0].AddXY(XValue, YValue);
          end
          else
          begin
            ShowMessage('Invalid data format in ' + FileName1 + ' at line ' + IntToStr(i + 1));
            Break;
          end;
        end;
      end
      else
      begin
        ShowMessage('File not found: ' + FileName1);
      end;
    end;

    // Pilih file kedua
    if OpenDialog2.Execute then
    begin
      FileName2 := OpenDialog2.FileName;
      if FileExists(FileName2) then
      begin
        FileLines2.LoadFromFile(FileName2);

        // Kosongkan ListBox2 dan Series2 dan Series3
        ListBox2.Clear;
        if Chart2.SeriesCount < 4 then
        begin
          Chart2.AddSeries(TLineSeries); // Tambahkan seri jika belum ada
          Chart2.AddSeries(TLineSeries); // Tambahkan seri jika belum ada
        end;
        Chart2.Series[2].Clear; // Pastikan seri 2 ada
        Chart2.Series[3].Clear; // Pastikan seri 3 ada

        // Proses file kedua
        for i := 0 to FileLines2.Count - 1 do
        begin
          LineData.CommaText := StringReplace(FileLines2[i], '|', ',', [rfReplaceAll]);

          if LineData.Count = 2 then
          begin
            XValue := StrToFloatDef(LineData[0], 0);
            YValue := StrToFloatDef(LineData[1], 0);

            ListBox2.Items.Add(FileLines2[i]);
            Chart2.Series[2].AddXY(XValue, YValue); // Tambahkan pada seri yang diinginkan
          end
          else
          begin
            ShowMessage('Invalid data format in ' + FileName2 + ' at line ' + IntToStr(i + 1));
            Break;
          end;
        end;
      end
      else
      begin
        ShowMessage('File not found: ' + FileName2);
      end;
    end;

    ShowMessage('Successfully loaded two files!');
  except
    on E: Exception do
      ShowMessage('Error: ' + E.Message);
  end;

  // Bebaskan memori
  FileLines1.Free;
  FileLines2.Free;
  LineData.Free;
end;

end.
